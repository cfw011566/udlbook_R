---
title: "Problem 3.8"
author: "CF Wang"
date: "2025-01-18"
format: html
---

```{r}
#| label: setup
#| include: false
#| fig-width: 6
#| fig-asp: 0.618
#| fig-align: center
#| out-width: 70%

library(ggplot2)
library(patchwork)
```

# Shallow neural network

```{r}
#| label: shallow_1_1_3

# Define a shallow neural network with, one input, one output, and three hidden units
shallow_1_1_3 <- function(x, activation_fn, phi_0, phi_1, phi_2, phi_3, theta_10, theta_11, theta_20, theta_21, theta_30, theta_31) {
  # figure 3.3 a-c
  pre_1 <- theta_10 + theta_11 * x
  pre_2 <- theta_20 + theta_21 * x
  pre_3 <- theta_30 + theta_31 * x

  # figure 3.3 d-f
  act_1 <- activation_fn(pre_1)
  act_2 <- activation_fn(pre_2)
  act_3 <- activation_fn(pre_3)

  # figure 3.3 g-i
  w_act_1 <- phi_1 * act_1
  w_act_2 <- phi_2 * act_2
  w_act_3 <- phi_3 * act_3

  # figure 3.3 j
  y <- phi_0 + w_act_1 + w_act_2 + w_act_3

  # Return everything we have calculated
  data.frame(x = x, y = y, pre1 = pre_1, pre2 = pre_2, pre3 = pre_3, act1 = act_1, act2 = act_2, act3 = act_3, wact1 = w_act_1, wact2 = w_act_2, wact3 = w_act_3)
}
```

```{r}
#| label: plot-neural
#| echo: false

# Plot the shallow neural network.  We'll assume input in is range [0,1] and output [-1,1]
# If the plot_all flag is set to true, then we'll plot all the intermediate stages as in Figure 3.3
plot_neural <- function(nn_result, plot_all = FALSE, x_data = NULL, y_data = NULL) {
  if (is.null(x_data)) {
    p0 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) + xlab("Input, x") + ylab("Output, y") +
      geom_line(mapping = aes(x = x, y = y), color = "skyblue", linewidth = 1.0)
  } else {
    p0 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) + xlab("Input, x") + ylab("Output, y") +
      geom_line(mapping = aes(x = x, y = y), color = "skyblue", linewidth = 1.0) +
      geom_point(data = data.frame(x = x_data, y = y_data), mapping = aes(x = x, y = y), size = 3, color = "purple")
  }
  
  # Plot intermediate plots if flag set
  if (plot_all) {
    p1 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("") + ylab("Preactivation") +
      geom_line(mapping = aes(x = x, y = pre1), color = "red3", linewidth = 0.75)
    p2 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("") + ylab("Preactivation") +
      geom_line(mapping = aes(x = x, y = pre2), color = "blue3", linewidth = 0.75)
    p3 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("") + ylab("Preactivation") +
      geom_line(mapping = aes(x = x, y = pre3), color = "green3", linewidth = 0.75)
    
    p4 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("") + ylab("Activation") +
      geom_line(mapping = aes(x = x, y = act1), color = "red3", linewidth = 0.75)
    p5 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("") + ylab("Activation") +
      geom_line(mapping = aes(x = x, y = act2), color = "blue3", linewidth = 0.75)
    p6 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("") + ylab("Activation") +
      geom_line(mapping = aes(x = x, y = act3), color = "green3", linewidth = 0.75)
    
    p7 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("Input, x") + ylab("Weighted Act") +
      geom_line(mapping = aes(x = x, y = wact1), color = "red3", linewidth = 0.75)
    p8 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("Input, x") + ylab("Weighted Act") +
      geom_line(mapping = aes(x = x, y = wact2), color = "blue3", linewidth = 0.75)
    p9 <- ggplot(nn_result) +
      xlim(range(x)) + ylim(c(-1, 1)) +
      xlab("Input, x") + ylab("Weighted Act") +
      geom_line(mapping = aes(x = x, y = wact3), color = "green3", linewidth = 0.75)
    
    grid_layout <- "
    ABC
    DEF
    GHI
    JJ#
    JJ#
    "
    p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 + p9 + p0 +
      plot_layout(design = grid_layout)
  } else {
    p0
  }
}
```

```{r}
#| label: input-of-neural-network

# Now lets define some parameters and run the neural network
theta_10 <- -0.2; theta_11 <-  0.4
theta_20 <- -0.9; theta_21 <-  0.9
theta_30 <-  1.1; theta_31 <- -0.7
phi_0 <- -0.23; phi_1 <- -1.3; phi_2 <- 1.3; phi_3 <- 0.66

# Define a range of input values
x <- seq(0, 2, 0.01)
```

# ReLU

```{r}
#| label: ReLU-function
#| echo: false
#| fig-width: 4
#| fig-asp: 1

# Define the Rectified Linear Unit (ReLU) function
ReLU <- function(preactivation) {
  ifelse(preactivation > 0, preactivation, 0)
}

z <- seq(-5, 5, 0.1)
RelU_z <- ReLU(z)

ggplot() +
  xlim(c(-5, 5)) +
  ylim(c(-5, 5)) +
  xlab("z") +
  ylab("ReLU[z]") +
  geom_line(
    mapping = aes(x = z, y = RelU_z),
    color = "red3",
    linewidth = 0.75)
```

```{r}
#| label: neural-network-ReLU
#| echo: false
#| fig-width: 8
#| fig-asp: 1.5

nn_result <- shallow_1_1_3(x, ReLU, phi_0, phi_1, phi_2, phi_3, theta_10, theta_11, theta_20, theta_21, theta_30, theta_31)

# And then plot it
plot_neural(nn_result, plot_all = TRUE)
```

# Heaviside step function

$$
heaviside(z) = \begin{cases} 0 & z < 0 \\ 1 & z \ge 0 \end{cases}
$$

```{r}
#| label: Heaviside
#| fig-width: 4
#| fig-asp: 1

heaviside <- function(preactivation) {
  ifelse(preactivation < 0, 0, 1)
}
z <- seq(-5, 5, 0.01)
heaviside_z <- heaviside(z)

ggplot() +
  geom_line(aes(x = z, y = heaviside_z), color = "red3")
```

```{r}
#| label: neural-network-Heaviside
#| echo: false
#| fig-width: 8
#| fig-asp: 1.5

# We run the neural network for each of these input values
# y, pre_1, pre_2, pre_3, act_1, act_2, act_3, w_act_1, w_act_2, w_act_3 = \
nn_result <- shallow_1_1_3(x, heaviside, phi_0, phi_1, phi_2, phi_3, theta_10, theta_11, theta_20, theta_21, theta_30, theta_31)

plot_neural(nn_result, plot_all = TRUE)
```

# Rectangular function

$$
rect(z) = \begin{cases} 0 & z < 0 \\ 1 & 0 \le z \ge 1 \\ 0 & z > 1\end{cases}.
$$

```{r}
#| label: Rectangular
#| echo: false
#| fig-width: 4
#| fig-asp: 1

rectangular <- function(preactivation) {
  ifelse(preactivation >= 0 & preactivation <= 1, 1, 0)
}
z <- seq(-5, 5, 0.01)
rectangular_z <- rectangular(z)

ggplot() +
  xlim(c(-5, 5)) +
  ylim(c(-5, 5)) +
  xlab("z") +
  ylab("rectangualr[z]") +
  geom_line(
    mapping = aes(x = z, y = rectangular_z),
    color = "red",
    linewidth = 0.75)
```

```{r}
#| label: run neural network with rectangular
#| fig-width: 8
#| fig-asp: 1.5

# We run the neural network for each of these input values
# y, pre_1, pre_2, pre_3, act_1, act_2, act_3, w_act_1, w_act_2, w_act_3 = \
nn_result <- shallow_1_1_3(x, rectangular, phi_0, phi_1, phi_2, phi_3, theta_10, theta_11, theta_20, theta_21, theta_30, theta_31)

# And then plot it
plot_neural(nn_result, plot_all = TRUE)
```

# Hyperbolic tangent function

```{r}
#| label: run neural network with tanh
#| fig-width: 8
#| fig-asp: 1.5

# We run the neural network for each of these input values
# y, pre_1, pre_2, pre_3, act_1, act_2, act_3, w_act_1, w_act_2, w_act_3 = \
nn_result <- shallow_1_1_3(x, tanh, phi_0, phi_1, phi_2, phi_3, theta_10, theta_11, theta_20, theta_21, theta_30, theta_31)

# And then plot it
plot_neural(nn_result, plot_all = TRUE)
```